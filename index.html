<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Donahue | Official Archive</title>
   
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
    <style>
        :root {
            --bg: #050505;
            --card-bg: #0A0A0A;
            --border: #222;
            --purple: #D8B4FE;
            --purple-glow: rgba(216, 180, 254, 0.2);
            --gold: #D4AF37;
            --text-main: #EAEAEA;
            --orange: #FFCC80;
            --orange-glow: rgba(255, 204, 128, 0.25);
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-main); overflow-x: hidden; height: 100vh; }
        .cinzel { font-family: 'Cinzel', serif; }
        .mono { font-family: 'Space Grotesk', monospace; }
        /* STARRY BACKGROUND */
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
            background: radial-gradient(circle at bottom center, #1a103c 0%, #000000 80%);
        }
        .star {
            position: absolute; border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: 0;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.3);
        }
        @keyframes twinkle { 0%, 100% { opacity: 0; } 50% { opacity: var(--opacity); } }
        /* UI ELEMENTS */
        .glass-panel {
            background: linear-gradient(180deg, rgba(20,20,20,0.85) 0%, rgba(10,10,10,0.98) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(216, 180, 254, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        /* CARDS */
        .masonry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
            padding-bottom: 140px;
        }
        .cosmos-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px;
            z-index: 10;
        }
        .cosmos-card:hover {
            border-color: var(--orange);
            transform: translateY(-4px);
            background: #111;
            box-shadow: 0 10px 40px -10px var(--orange-glow);
        }
        .cosmos-card:active {
            border-color: #FFFFFF;
            box-shadow: 0 10px 40px -10px rgba(255, 255, 255, 0.25);
        }
        .cosmos-card i { transition: transform 0.3s ease; }
        .cosmos-card:hover i { transform: scale(1.2) rotate(10deg); color: var(--orange); }
        /* DOCK */
        .dock-container {
            position: fixed; bottom: 32px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 50;
        }
        .dock {
            background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.15); padding: 8px; border-radius: 99px;
            display: flex; gap: 8px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.8); pointer-events: auto;
        }
        .dock-btn {
            padding: 10px 24px; border-radius: 99px; font-size: 11px; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.1em; color: #888;
            transition: all 0.2s; cursor: pointer; border: 1px solid transparent;
        }
        .dock-btn:hover { color: white; background: rgba(255,255,255,0.05); }
        .dock-btn.active { background: white; color: black; box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        /* ANATOMY */
        .anatomy-dot {
            width: 20px; height: 20px; border-radius: 50%;
            position: absolute; left: 50%; transform: translateX(-50%);
            cursor: pointer; transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(216, 180, 254, 0.4); z-index: 20;
        }
        .anatomy-dot:hover {
            transform: translateX(-50%) scale(1.5);
            background-color: #fff !important;
            box-shadow: 0 0 40px var(--purple);
        }
        /* SEARCH */
        .search-input {
            background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(10px);
            border: 1px solid var(--border); color: white;
            padding: 10px 20px 10px 40px; border-radius: 99px; font-size: 12px;
            width: 260px; transition: all 0.3s ease; outline: none;
        }
        .search-input:focus { border-color: var(--purple); width: 320px; box-shadow: 0 0 20px rgba(216, 180, 254, 0.2); }
        /* VIEWS */
        .view-section {
            display: none; padding-top: 100px; padding-bottom: 150px;
            width: 100%; min-height: 100vh; animation: fadeIn 0.4s ease;
        }
        .view-section.active { display: block; }
       
        #view-home.active {
            display: flex; flex-direction: column; justify-content: center; align-items: center; padding-top: 0;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* UTILS */
        .hidden { display: none !important; }
        .profile-img { box-shadow: 0 0 50px rgba(216, 180, 254, 0.15); transition: 0.5s; }
        .profile-img:hover { box-shadow: 0 0 80px rgba(216, 180, 254, 0.3); transform: scale(1.02); }
        .diamond-box {
            border: 1px solid rgba(216, 180, 254, 0.3); padding: 10px 30px; transform: skew(-15deg);
            display: inline-block; background: rgba(216, 180, 254, 0.05);
        }
        .diamond-text { transform: skew(15deg); color: var(--purple); text-shadow: 0 0 15px rgba(216, 180, 254, 0.5); }
       
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--purple); }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div id="stars-container" class="stars-container"></div>
    <div class="fixed top-0 left-0 w-full p-6 z-40 flex justify-between items-start pointer-events-none">
        <div class="pointer-events-auto flex items-center gap-3 cursor-pointer group" onclick="window.app.nav('home')">
            <div class="w-10 h-10 border border-purple-400/30 flex items-center justify-center rotate-45 bg-black/50 backdrop-blur-md transition-all group-hover:rotate-0 group-hover:border-purple-400">
                <span class="cinzel font-bold text-lg text-purple-300 -rotate-45 group-hover:rotate-0">HM</span>
            </div>
            <div>
                <h1 class="cinzel font-bold text-white text-xs tracking-widest uppercase">Hidden Meanings</h1>
                <p class="text-[9px] text-purple-400 font-bold uppercase tracking-wider">Official Archive</p>
            </div>
        </div>
       
        <div class="pointer-events-auto relative group">
            <svg class="w-3.5 h-3.5 absolute left-4 top-1/2 -translate-y-1/2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <input type="text" id="global-search" oninput="window.app.search(this.value)" placeholder="SEARCH ARCHIVE..." class="search-input placeholder-gray-500 font-mono uppercase">
        </div>
    </div>
    <div id="app-loader" class="fixed inset-0 bg-[#050505] z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-12 h-12 border-2 border-purple-500/30 border-t-purple-400 rounded-full animate-spin mb-4"></div>
        <p class="text-purple-300 text-xs uppercase tracking-[0.3em] font-bold animate-pulse">Initializing Library...</p>
    </div>
    <div class="h-screen overflow-y-auto custom-scrollbar" id="scroll-wrapper">
       
        <section id="view-home" class="view-section active">
            <div class="relative z-10 max-w-5xl text-center fade-in pt-20">
                <div class="mb-10 flex justify-center">
                    <div class="relative w-40 h-40 rounded-full p-1 border-2 border-purple-500/40 bg-[#111] profile-img">
                        <img src="bill_profile.jpg" class="w-full h-full object-cover rounded-full opacity-90 transition-opacity grayscale hover:grayscale-0"
                             onerror="this.src='https://ui-avatars.com/api/?name=Bill+Donahue&background=000&color=d8b4fe&size=160'">
                    </div>
                </div>
                <div class="mb-8 inline-flex items-center gap-3 border border-purple-500/30 px-5 py-2 rounded-full bg-black/40 backdrop-blur-md">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span>
                    <span class="text-[10px] text-purple-200 uppercase tracking-[0.2em] font-bold" id="status-bar">System Online</span>
                </div>
                <h1 class="cinzel text-5xl md:text-8xl font-black mb-8 leading-none tracking-tight text-white drop-shadow-2xl">
                    HIDDEN<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-white italic">MEANINGS</span>
                </h1>
                <div class="mb-12">
                     <div class="diamond-box">
                        <span class="diamond-text cinzel text-xs font-bold tracking-[0.3em] uppercase block">Inspired by Bill Donahue</span>
                    </div>
                </div>
                <div class="max-w-lg mx-auto relative group w-full mb-8">
                    <input type="text" id="ai-input" placeholder="Ask the Teacher (e.g. 'Pineal')..."
                           class="w-full bg-white/5 border border-white/10 rounded-full py-4 pl-8 pr-16 text-sm text-white placeholder-stone-500 focus:outline-none focus:border-purple-400 font-mono transition-all backdrop-blur-md"
                           onkeydown="if(event.key === 'Enter') window.app.performAISearch()">
                    <button onclick="window.app.performAISearch()" class="absolute right-2 top-2 bottom-2 bg-purple-600 text-white w-10 rounded-full flex items-center justify-center hover:bg-white hover:text-black transition-colors shadow-lg">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </section>
        <section id="view-library" class="view-section px-6">
            <div class="max-w-[1800px] mx-auto w-full">
                <div class="flex flex-col md:flex-row justify-between items-end mb-16 pb-8 border-b border-white/10">
                    <div>
                        <h2 class="cinzel text-5xl font-bold text-white mb-2 tracking-tight">The Catalog</h2>
                        <p class="font-mono text-purple-400 text-xs uppercase tracking-[0.2em]">Comprehensive Subject Index</p>
                    </div>
                    <div class="text-right mt-8 md:mt-0">
                        <p class="text-stone-500 font-mono text-xs" id="total-topics-display">Loading...</p>
                    </div>
                </div>
                <div id="category-grid" class="masonry-grid"></div>
            </div>
        </section>
        <section id="view-list" class="view-section bg-stone-900/10 px-6">
            <div class="max-w-6xl mx-auto w-full">
                <button onclick="window.app.nav('library')" class="mb-10 text-stone-500 hover:text-purple-300 flex items-center gap-2 text-[10px] font-bold uppercase tracking-[0.2em] transition-colors">
                    <span>←</span> Back to Index
                </button>
                <div class="mb-12 pl-6 border-l-2 border-purple-500">
                    <span class="text-purple-400 text-[10px] font-bold uppercase tracking-[0.3em] mb-3 block">Selected Topic</span>
                    <h2 id="active-category-title" class="cinzel text-4xl md:text-6xl font-bold text-white leading-tight"></h2>
                    <p id="active-category-count" class="text-stone-500 text-xs tracking-[0.2em] font-bold uppercase mt-6 pt-6 border-t border-white/5 inline-block"></p>
                </div>
                <div id="list-container" class="grid grid-cols-1 lg:grid-cols-2 gap-4"></div>
            </div>
        </section>
        <section id="view-anatomy" class="view-section px-6">
            <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-20 items-center min-h-[70vh] w-full">
                <div class="relative flex justify-center order-2 lg:order-1">
                    <div class="relative w-[300px] h-[650px] border border-white/10 rounded-full bg-[#080808] flex justify-center items-center shadow-[0_0_80px_-20px_rgba(168,85,247,0.15)]">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(255,255,255,0.03),transparent_70%)] rounded-full"></div>
                        <div class="absolute top-[10%] bottom-[10%] w-px bg-gradient-to-b from-transparent via-purple-500/30 to-transparent"></div>
                        <div class="anatomy-dot bg-violet-500" style="top: 10%;" onclick="window.app.showAnatomy('Crown / Pineal', 'The Single Eye. Peniel. The light receptor.')"></div>
                        <div class="anatomy-dot bg-indigo-500" style="top: 22%;" onclick="window.app.showAnatomy('Brow / Pituitary', 'The Third Eye. Command Center.')"></div>
                        <div class="anatomy-dot bg-blue-500" style="top: 34%;" onclick="window.app.showAnatomy('Thyroid / Throat', 'The Word (Logos). Vibration.')"></div>
                        <div class="anatomy-dot bg-green-500" style="top: 46%;" onclick="window.app.showAnatomy('Heart', 'Thymus. The Green Ray. Balance.')"></div>
                        <div class="anatomy-dot bg-yellow-500" style="top: 58%;" onclick="window.app.showAnatomy('Solar', 'Place of the Sun (Son). The Manger.')"></div>
                        <div class="anatomy-dot bg-orange-500" style="top: 70%;" onclick="window.app.showAnatomy('Sacral', 'Sexual Center. The Furnace.')"></div>
                        <div class="anatomy-dot bg-red-500" style="top: 82%;" onclick="window.app.showAnatomy('Root', 'Egypt. Physical Bondage.')"></div>
                    </div>
                </div>
                <div class="order-1 lg:order-2">
                    <span class="text-purple-400 font-mono text-xs uppercase tracking-[0.2em] mb-4 block">Interactive Map</span>
                    <h2 class="cinzel text-5xl md:text-7xl font-bold text-white mb-8 leading-none">The Temple<br>Of God</h2>
                    <div id="anatomy-info" class="p-10 border border-white/10 bg-[#111] backdrop-blur-md rounded-xl border-l-2 border-purple-500 relative z-20">
                        <h3 id="anatomy-title" class="cinzel text-2xl text-purple-200 mb-4 uppercase tracking-widest font-bold">Select a Center</h3>
                        <p id="anatomy-desc" class="text-stone-400 text-lg leading-relaxed font-light italic">
                            "Know ye not that ye are the temple of God?" Click the points on the diagram to reveal the biological decoding of scripture.
                        </p>
                    </div>
                </div>
            </div>
        </section>
        <section id="view-resources" class="view-section px-6 max-w-5xl mx-auto">
            <h2 class="cinzel text-4xl font-bold text-white mb-16 text-center uppercase tracking-widest">Primary Sources</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <a href="https://www.hiddenmeanings.com/" target="_blank" class="cosmos-card p-10 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">H</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">HiddenMeanings.com</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">Main Portal</p>
                </a>
                <a href="https://lifestyleluminaries.blogspot.com/p/bill-donahue.html" target="_blank" class="cosmos-card p-10 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">L</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Lifestyle Luminaries</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">Video Archive</p>
                </a>
                <a href="https://thehiddenlighthouse.blogspot.com/2012/09/the-hidden-lighthouse.html?m=1" target="_blank" class="cosmos-card p-10 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">B</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Lighthouse Blog</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">2012 Writings</p>
                </a>
                <a href="https://archive.org/details/1-revised-bill-donahue-speaks-book-of-secret-doctrines/page/18/mode/1up?ui=embed&wrapper=false" target="_blank" class="cosmos-card p-10 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">S</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Secret Doctrines</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">PDF Book</p>
                </a>
            </div>
        </section>
        <section id="view-search" class="view-section px-6 max-w-5xl mx-auto bg-[#050505]">
            <div id="ai-box" class="mb-12 bg-white/5 p-8 border-l-4 border-purple-500 hidden rounded-xl fade-in">
                <span class="text-purple-400 font-mono text-[10px] uppercase tracking-widest mb-3 block">Teacher's Insight</span>
                <div id="ai-text-output" class="text-stone-200 text-xl leading-relaxed italic font-light mb-4 font-serif"></div>
                <div class="flex items-center gap-4">
                    <button id="play-pause-btn" onclick="window.app.togglePlayPause()" class="flex items-center gap-2 text-xs font-bold text-purple-300 uppercase tracking-widest hover:text-white"><i class="fa-solid fa-play"></i> Play</button>
                    <button id="stop-btn" onclick="window.app.stopAudio()" class="flex items-center gap-2 text-xs font-bold text-purple-300 uppercase tracking-widest hover:text-white hidden"><i class="fa-solid fa-stop"></i> Stop</button>
                </div>
            </div>
           
            <div class="flex justify-between items-end mb-8 border-b border-white/10 pb-4">
                <h2 id="search-title" class="cinzel text-2xl font-bold text-white">Archive Matches</h2>
                <div id="download-area"></div>
            </div>
            
            <div id="search-list" class="grid grid-cols-1 lg:grid-cols-2 gap-4 pb-20"></div>
        </section>
        <section id="view-social" class="view-section px-6 max-w-[1800px] mx-auto">
            <h2 class="cinzel text-4xl font-bold text-white mb-8 text-center uppercase tracking-widest">Community Hub</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-16 max-w-4xl mx-auto">
                <a href="https://www.facebook.com/groups/356472414984195" target="_blank" class="p-8 border border-white/10 rounded-xl bg-gradient-to-br from-[#1877F2]/20 to-black hover:from-[#1877F2]/40 transition-all group flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <i class="fa-brands fa-facebook text-4xl text-[#1877F2]"></i>
                        <div>
                            <h3 class="font-bold text-white text-lg">Join the Group</h3>
                            <p class="text-stone-400 text-xs">Official Discussion</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-arrow-up-right-from-square text-white/50 group-hover:text-white"></i>
                </a>
                <a href="https://www.facebook.com/groups/356472414984195/media" target="_blank" class="p-8 border border-white/10 rounded-xl bg-gradient-to-br from-purple-900/20 to-black hover:from-purple-900/40 transition-all group flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <i class="fa-solid fa-photo-film text-4xl text-purple-400"></i>
                        <div>
                            <h3 class="font-bold text-white text-lg">Media Gallery</h3>
                            <p class="text-stone-400 text-xs">Photos & Videos</p>
                        </div>
                    </div>
                    <i class="fa-solid fa-arrow-up-right-from-square text-white/50 group-hover:text-white"></i>
                </a>
            </div>

            <div class="mb-8 flex items-end justify-between border-b border-white/10 pb-4">
                <h3 class="cinzel text-2xl text-white">Recent Media</h3>
                <p class="text-[10px] text-stone-500 uppercase tracking-widest">Live Gallery Link</p>
            </div>
            
            <div class="masonry-grid" id="social-gallery-grid">
                </div>
        </section>
        <section id="view-videos" class="view-section px-6">
              <div class="max-w-[1800px] mx-auto w-full">
                <div class="mb-16 pb-8 border-b border-white/10">
                  <h2 class="cinzel text-5xl font-bold text-white mb-2">Video Archive</h2>
                  <p class="font-mono text-purple-400 text-xs uppercase tracking-[0.2em]">
                    Official YouTube Collection
                  </p>
                </div>

                <div id="video-grid" class="masonry-grid"></div>
              </div>
            </section>
    </div>
    <div class="dock-container">
        <div class="dock">
            <button class="dock-btn active" id="btn-home" onclick="window.app.nav('home')">Home</button>
            <button class="dock-btn" id="btn-library" onclick="window.app.nav('library')">Library</button>
            <button class="dock-btn" id="btn-videos" onclick="window.app.nav('videos')">Youtube Videos</button>
            <button class="dock-btn" id="btn-anatomy" onclick="window.app.nav('anatomy')">Temple</button>
            <button class="dock-btn" id="btn-resources" onclick="window.app.nav('resources')">Links</button>
            <button class="dock-btn" id="btn-social" onclick="window.app.nav('social')">Social</button>
            <div class="w-px bg-white/20 mx-1"></div>
            <button class="dock-btn text-red-400 hover:text-red-300" onclick="window.app.scanForBrokenLinks()" title="Scan for Bad Links">
                <i class="fa-solid fa-stethoscope"></i>
            </button>
        </div>
    </div>
    <script>
        // STARS
        function createStars() {
            const container = document.getElementById('stars-container');
            if(!container) return;
            for(let i=0; i<150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                const size = Math.random() * 2 + 0.5;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.backgroundColor = `hsl(${Math.random() * 40}, ${Math.random() * 20 + 70}%, ${Math.random() * 20 + 70}%)`;
                star.style.boxShadow = `0 0 ${size*2}px ${star.style.backgroundColor}`;
                star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                star.style.setProperty('--opacity', Math.random() * 0.5 + 0.5);
                container.appendChild(star);
            }
        }
        window.app = {
            data: [],
            currentUtterance: null,
            isSpeaking: false,
           
            // --- HELPER: Extract ID from various Youtube URL formats ---
            getVideoID: function(url) {
                if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        },

        // --- HELPER: Get Topic for a Video ID (From CSV Data) ---
        getTopicByVideoID: function(vidId) {
            if (!this.data || this.data.length === 0) return null;
            const found = this.data.find(row => this.getVideoID(row.URL) === vidId);
            return found ? found.TOPIC : null;
        },

        // ======================================
        // YOUTUBE VIDEO ARCHIVE
        // ======================================
        youtube: {
            apiKey: "AIzaSyCZfKNXHgjZG1h13QhDH5-ubtVC0xDPfe4",
            uploadsPlaylistId: "UUinvwSeMdmuuzyMWrS0tGTg",
            videos: [],
            nextPageToken: null,
            loading: false,

            fetchVideos: async function () {
                if (this.loading) return;
                this.loading = true;

                let url = `https://www.googleapis.com/youtube/v3/playlistItems?key=${this.apiKey}&playlistId=${this.uploadsPlaylistId}&part=snippet&maxResults=12`;
                if (this.nextPageToken) url += `&pageToken=${this.nextPageToken}`;

                try {
                    const res = await fetch(url);
                    const data = await res.json();
                    this.nextPageToken = data.nextPageToken || null;

                    const newVideos = data.items.map(item => ({
                        id: item.snippet.resourceId.videoId,
                        title: item.snippet.title,
                        description: item.snippet.description,
                        thumbnail: item.snippet.thumbnails.high.url
                    }));

                    this.videos.push(...newVideos);
                    this.renderVideos();
                } catch (e) { console.error("YT Error", e); }
                this.loading = false;
            },

            renderVideos: function () {
                const grid = document.getElementById("video-grid");
                if (!grid) return;
                
                grid.innerHTML = this.videos.map(v => {
                    const topic = window.app.getTopicByVideoID(v.id);
                    // Escaping for onclick
                    const safeTopic = topic ? topic.replace(/'/g, "\\'").replace(/"/g, '&quot;') : '';

                    return `
                    <div class="cosmos-card group cursor-pointer" onclick="window.open('https://www.youtube.com/watch?v=${v.id}', '_blank')">
                        <div class="relative aspect-video overflow-hidden">
                            <img src="${v.thumbnail}" class="absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                            <div class="absolute inset-0 flex items-center justify-center">
                                <i class="fa-solid fa-play text-4xl text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg"></i>
                            </div>
                        </div>
                        <div class="p-4 flex flex-col flex-1">
                            <h3 class="text-sm text-gray-200 group-hover:text-white line-clamp-2 mb-2">${v.title}</h3>
                            <div class="mt-auto">
                                ${topic ? 
                                    `<span class="text-[9px] font-bold uppercase tracking-widest text-purple-400 border border-purple-500/30 px-2 py-1 rounded hover:bg-purple-500 hover:text-white transition-colors inline-block" 
                                           onclick="event.stopPropagation(); window.app.openTopic('${safeTopic}')">
                                        Topic: ${topic}
                                     </span>` 
                                    : ''
                                }
                            </div>
                        </div>
                    </div>
                `}).join("");
            }
        },

        init: function() {
            createStars();
            this.setupStarInteractions();
            this.renderSocialGallery();
            this.youtube.fetchVideos();

            // SCROLL LISTENER
            const wrapper = document.getElementById('scroll-wrapper');
            wrapper.addEventListener("scroll", () => {
                if (wrapper.scrollTop + wrapper.clientHeight >= wrapper.scrollHeight - 800) {
                    this.youtube.fetchVideos();
                }
            });

            // CSV LOAD WITH REFINED PARSING
            Papa.parse('catalog.csv', {
                download: true,
                header: true,
                complete: (results) => {
                    this.data = results.data
                        .filter(row => {
                            const t = row['TITLE OF VIDEO'];
                            const top = row.TOPIC;
                            if (!t || !t.trim() || !top || !top.trim()) return false;
                            if (top.toLowerCase().startsWith('http')) return false;
                            if (!isNaN(top)) return false;
                            return true;
                        })
                        .map(row => {
                            let cleanTopic = row.TOPIC.trim();
                            cleanTopic = cleanTopic.replace(/^and\s+/i, ''); 
                            row.TOPIC = cleanTopic;
                            return row;
                        })
                        .filter(row => row.TOPIC.length > 0 && row.TOPIC.toLowerCase() !== 'and');

                    this.renderCategories();
                    document.getElementById('status-bar').innerText = `${this.data.length} Records Online`;
                    
                    // RE-RENDER YOUTUBE VIDEOS NOW THAT WE HAVE DATA TO LINK TOPICS
                    this.youtube.renderVideos();
                }
            });
           
            this.nav('home');
            setTimeout(() => document.getElementById('app-loader').classList.add('hidden'), 300);
        },

        // UTILS
        setupStarInteractions: function() { /* (Keep existing star code) */ },
       
        // --- TOPIC SORTING & RENDERING ---
        getUniqueTopics: function() {
            // A-Z Sort
            return [...new Set(this.data.map(i => i.TOPIC))].sort((a, b) => a.localeCompare(b));
        },

        getIcon: function(t) {
            const tl = t.toLowerCase();
            if(tl.includes("zodiac") || tl.includes("astro")) return "fa-meteor";
            if(tl.includes("bible") || tl.includes("testament")) return "fa-book-bible";
            if(tl.includes("brain") || tl.includes("mind") || tl.includes("human")) return "fa-brain";
            if(tl.includes("meditation") || tl.includes("silence")) return "fa-om";
            if(tl.includes("jesus") || tl.includes("christ")) return "fa-cross";
            if(tl.includes("alien") || tl.includes("ufo")) return "fa-shuttle-space";
            if(tl.includes("sex") || tl.includes("anatomy")) return "fa-dna";
            return "fa-star";
        },

        renderCategories: function() {
            const topics = this.getUniqueTopics();
            const grid = document.getElementById('category-grid');
            document.getElementById('total-topics-display').innerText = `${topics.length} Categories`;
           
            grid.innerHTML = topics.map((t, i) => {
                const count = this.data.filter(d => d.TOPIC === t).length;
                const icon = this.getIcon(t);
                const safeTopic = t.replace(/'/g, "\\'").replace(/"/g, '&quot;');
               
                return `
                    <div onclick="window.app.openTopic('${safeTopic}')" class="cosmos-card topic-card p-6 group">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-xs font-mono text-gray-500">${String(i+1).padStart(2, '0')}</span>
                            <i class="fa-solid ${icon} text-gray-600 group-hover:text-purple-400 transition-colors text-lg"></i>
                        </div>
                        <h3 class="text-sm font-medium text-gray-200 leading-snug mb-8 group-hover:text-white line-clamp-3">${t}</h3>
                        <div class="flex justify-between items-end border-t border-white/10 pt-3 mt-auto">
                            <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">${count} Items</span>
                            <span class="text-purple-400 opacity-50 group-hover:opacity-100 transition-opacity">→</span>
                        </div>
                    </div>
                `;
            }).join('');
        },

        // --- UPDATED LIST VIEW WITH THUMBNAILS ---
        openTopic: function(topic) {
            this.nav('list');
            document.getElementById('active-category-title').innerText = topic;
           
            const items = this.data
                .filter(i => i.TOPIC === topic)
                .sort((a, b) => a['TITLE OF VIDEO'].localeCompare(b['TITLE OF VIDEO']));

            document.getElementById('active-category-count').innerText = `${items.length} LECTURES`;
            const container = document.getElementById('list-container');
           
            container.innerHTML = items.map(l => {
                const vidId = this.getVideoID(l.URL);
                const hasUrl = !!vidId;
                const thumbUrl = vidId ? `https://img.youtube.com/vi/${vidId}/mqdefault.jpg` : null;

                return `
                    <div class="p-3 border border-white/10 rounded-lg flex gap-4 items-center hover:bg-white/5 transition-all group mb-2 bg-[#0A0A0A]">
                        <div class="w-24 h-16 bg-black shrink-0 rounded overflow-hidden relative border border-white/10">
                            ${thumbUrl 
                                ? `<img src="${thumbUrl}" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity">` 
                                : `<div class="w-full h-full flex items-center justify-center text-gray-700"><i class="fa-solid fa-ban"></i></div>`
                            }
                        </div>
                       
                        <div class="flex-1 min-w-0">
                            <h4 class="text-sm font-medium text-gray-300 group-hover:text-white truncate pr-4">${l['TITLE OF VIDEO']}</h4>
                            <p class="text-[10px] text-gray-600 font-mono mt-1 truncate">ID: ${vidId || 'N/A'}</p>
                        </div>

                        <div class="shrink-0">
                            ${hasUrl ?
                                `<a href="${l.URL}" target="_blank" class="w-8 h-8 rounded-full border border-purple-500/30 flex items-center justify-center text-purple-400 hover:bg-purple-500 hover:text-white transition-all">
                                    <i class="fa-solid fa-play text-xs pl-0.5"></i>
                                 </a>` :
                                `<span class="text-[9px] text-gray-600 font-bold uppercase tracking-widest border border-white/10 px-2 py-1 rounded">Missing</span>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        },

        search: function(q) {
            if(!q) return;
            this.nav('search');
            document.getElementById('search-title').innerText = "Archive Matches";
            const results = this.data.filter(i => 
                i['TITLE OF VIDEO'].toLowerCase().includes(q.toLowerCase()) || 
                i.TOPIC.toLowerCase().includes(q.toLowerCase())
            );
           
            document.getElementById('search-list').innerHTML = results.map(l => {
                const vidId = this.getVideoID(l.URL);
                return `
                <div class="p-4 border-b border-white/10 flex justify-between items-center group hover:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4">
                        ${vidId ? `<img src="https://img.youtube.com/vi/${vidId}/default.jpg" class="w-12 h-9 rounded object-cover opacity-50">` : ''}
                        <div>
                            <div class="text-[9px] text-gray-500 uppercase tracking-widest mb-1">${l.TOPIC}</div>
                            <h4 class="text-sm text-white font-medium">${l['TITLE OF VIDEO']}</h4>
                        </div>
                    </div>
                    ${l.URL ? `<a href="${l.URL}" target="_blank" class="text-purple-400 text-xs font-bold uppercase tracking-widest hover:text-white">OPEN ↗</a>` : ''}
                </div>`;
            }).join('');
        },

        // --- NEW: API-BASED SCAN FOR BROKEN LINKS ---
        scanForBrokenLinks: async function() {
            this.nav('search');
            document.getElementById('search-title').innerText = "Scanning YouTube Status...";
            document.getElementById('ai-box').classList.add('hidden');
            const list = document.getElementById('search-list');
            document.getElementById('download-area').innerHTML = ''; // clear old button
            list.innerHTML = '<div class="text-center p-8"><i class="fa-solid fa-circle-notch fa-spin text-purple-500 text-2xl"></i><p class="mt-4 text-stone-400 text-xs font-mono uppercase tracking-widest">Verifying with YouTube API...</p></div>';

            // 1. Gather all IDs
            const allItems = this.data.filter(i => i.URL && i.URL.includes('http'));
            const idMap = {}; 
            const idsToCheck = [];

            allItems.forEach(item => {
                const id = this.getVideoID(item.URL);
                if (id) {
                    if (!idMap[id]) {
                        idMap[id] = [];
                        idsToCheck.push(id);
                    }
                    idMap[id].push(item);
                }
            });

            // 2. Batch Requests (50 at a time)
            const batchSize = 50;
            const validIds = new Set();

            for (let i = 0; i < idsToCheck.length; i += batchSize) {
                const batch = idsToCheck.slice(i, i + batchSize);
                const url = `https://www.googleapis.com/youtube/v3/videos?key=${this.youtube.apiKey}&part=id&id=${batch.join(',')}`;
                try {
                    const res = await fetch(url);
                    const json = await res.json();
                    if (json.items) {
                        json.items.forEach(item => validIds.add(item.id));
                    }
                } catch (e) {
                    console.error("Scan error", e);
                }
            }

            // 3. Determine Broken Links (IDs we sent but didn't get back)
            const brokenItems = [];
            idsToCheck.forEach(id => {
                if (!validIds.has(id)) {
                    brokenItems.push(...idMap[id]);
                }
            });

            // 4. Render Results
            document.getElementById('search-title').innerText = `Found ${brokenItems.length} Broken / Private Links`;
            
            if (brokenItems.length === 0) {
                list.innerHTML = `<div class="p-8 text-center text-green-500 mono">All links are active and public!</div>`;
                return;
            }

            // 5. ENABLE EXPORT
            // Create CSV Content
            let csvContent = "data:text/csv;charset=utf-8,TITLE,TOPIC,URL\n";
            brokenItems.forEach(row => {
                csvContent += `"${row['TITLE OF VIDEO']}","${row.TOPIC}","${row.URL}"\n`;
            });
            const encodedUri = encodeURI(csvContent);
            
            document.getElementById('download-area').innerHTML = `
                <a href="${encodedUri}" download="bad_links_report.csv" class="px-4 py-2 bg-red-900/30 text-red-400 border border-red-900 rounded text-xs font-bold uppercase tracking-widest hover:bg-red-900 hover:text-white transition-all flex items-center gap-2">
                    <i class="fa-solid fa-download"></i> Download Report (.csv)
                </a>
            `;

            list.innerHTML = brokenItems.map(l => `
                <div class="p-4 border-b border-red-900/30 flex justify-between items-center group hover:bg-red-900/10 transition-colors">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-9 bg-red-900/20 rounded flex items-center justify-center text-red-500">
                            <i class="fa-solid fa-link-slash"></i>
                        </div>
                        <div>
                            <div class="text-[9px] text-red-400 uppercase tracking-widest mb-1">Video Deleted / Private</div>
                            <h4 class="text-sm text-white font-medium">${l['TITLE OF VIDEO']}</h4>
                            <p class="text-[10px] text-gray-600 font-mono mt-1">${l.TOPIC}</p>
                        </div>
                    </div>
                    <a href="${l.URL}" target="_blank" class="text-gray-500 text-xs font-bold uppercase tracking-widest hover:text-white">CHECK ↗</a>
                </div>`
            ).join('');
        },

        // --- RENDER SOCIAL (SIMULATED GALLERY) ---
        renderSocialGallery: function() {
            const grid = document.getElementById('social-gallery-grid');
            if(!grid) return;
            // Generate 6 "fake" placeholders that link to the media page
            // This bypasses strict CORS policies while giving the user the gallery feel
            let html = '';
            const placeholders = ['Community Photos', 'Recent Events', 'Group Media', 'Shared Memories', 'Discussion Archives', 'Latest Uploads'];
            
            for(let i=0; i<6; i++) {
                html += `
                <a href="https://www.facebook.com/groups/356472414984195/media" target="_blank" class="cosmos-card group cursor-pointer block min-h-[200px]">
                    <div class="relative h-40 bg-[#111] flex items-center justify-center overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-60"></div>
                        <i class="fa-brands fa-facebook text-5xl text-[#1877F2] opacity-30 group-hover:scale-110 group-hover:opacity-60 transition-all duration-500"></i>
                    </div>
                    <div class="p-4 border-t border-white/10 bg-[#0A0A0A]">
                        <h3 class="text-sm text-gray-200 group-hover:text-white mb-1">${placeholders[i]}</h3>
                        <p class="text-[10px] text-purple-400 font-bold uppercase tracking-widest group-hover:text-purple-300">View Gallery ↗</p>
                    </div>
                </a>`;
            }
            grid.innerHTML = html;
        },

        // --- AI VOICE: AMERICAN PROFESSOR ---
        togglePlayPause: function() {
            const text = document.getElementById('ai-text-output').innerText;
            if (!('speechSynthesis' in window) || !text) return;

            const playPauseBtn = document.getElementById('play-pause-btn');
            const stopBtn = document.getElementById('stop-btn');

            if (this.isSpeaking) {
                speechSynthesis.pause();
                this.isSpeaking = false;
                playPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i> Play';
            } else {
                if (this.currentUtterance && speechSynthesis.paused) {
                    speechSynthesis.resume();
                } else {
                    this.currentUtterance = new SpeechSynthesisUtterance(text);
                    const voices = speechSynthesis.getVoices();
                    
                    // VOICE STRATEGY: AMERICAN MALE
                    // 1. "Microsoft David" (Standard Win)
                    // 2. "Alex" (Standard Mac)
                    // 3. Any "en-US" male
                    
                    let selectedVoice = voices.find(v => v.name.includes("David") && v.name.includes("Microsoft"));
                    if (!selectedVoice) selectedVoice = voices.find(v => v.name === "Alex");
                    if (!selectedVoice) selectedVoice = voices.find(v => v.lang === "en-US" && (v.name.includes("Male") || v.gender === 'male'));
                    
                    // Fallback to anything US
                    if (!selectedVoice) selectedVoice = voices.find(v => v.lang === "en-US");

                    if (selectedVoice) this.currentUtterance.voice = selectedVoice;
                    
                    // PROFESSOR SETTINGS: Steady, slightly deeper
                    this.currentUtterance.rate = 0.9; 
                    this.currentUtterance.pitch = 0.8; 

                    this.currentUtterance.onend = () => {
                        this.isSpeaking = false;
                        playPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i> Play';
                        stopBtn.classList.add('hidden');
                    };
                    speechSynthesis.speak(this.currentUtterance);
                }
                this.isSpeaking = true;
                playPauseBtn.innerHTML = '<i class="fa-solid fa-pause"></i> Pause';
                stopBtn.classList.remove('hidden');
            }
        },
       
        performAISearch: function() {
            const input = document.getElementById('ai-input');
            const q = (input ? input.value : '').trim();
            if (!q) return;
            if (input) input.value = '';
            this.nav('search');
           
            const aiBox = document.getElementById('ai-box');
            const aiText = document.getElementById('ai-text-output');
            aiBox.classList.remove('hidden');
            aiText.innerText = "Consulting the archives...";
            this.search(q);
           
            setTimeout(() => {
                let resp = `The hidden meaning of "${q}" is found within the biological processes of the human body.`;
                const lq = q.toLowerCase();
                if(lq.includes('pineal') || lq.includes('eye')) resp = "The Single Eye is the Pineal Gland. It is the light receptor of the body where Jacob saw God face to face. When your eye is single, your whole body is full of light.";
                else if(lq.includes('egypt')) resp = "Egypt represents the lower mind, the physical bondage of the senses. We must cross the Red Sea of emotion to reach the Promised Land of the higher mind.";
                else if(lq.includes('jesus')) resp = "Jesus is the Greek word for Joshua. It represents the electrical energy rising up the spine to the brain, waiting to be born in the manger of the solar plexus.";
                else if(lq.includes('east')) resp = "Look to the East. The right hemisphere of the brain. The place of the rising sun, where the spiritual intellect is born.";
                else if(lq.includes('meditation')) resp = "We must shut down the five senses. Take no thought. In the silence, the electrical energy moves to the Pineal Gland.";
                aiText.innerText = resp;
            }, 1500);
        },
       
        stopAudio: function() {
            if (this.currentUtterance) {
                speechSynthesis.cancel();
                this.currentUtterance = null;
                this.isSpeaking = false;
                document.getElementById('play-pause-btn').innerHTML = '<i class="fa-solid fa-play"></i> Play';
                document.getElementById('stop-btn').classList.add('hidden');
            }
        },
       
        nav: function(id) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));
            const target = document.getElementById('view-' + id);
            if(target) target.classList.add('active');
            const btn = document.getElementById('btn-' + id);
            if(btn) btn.classList.add('active');
            if(id !== 'search') document.getElementById('global-search').value = '';
            window.scrollTo(0,0);
        },
       
        showView: function(id) { this.nav(id); },
        showAnatomy: function(t,d) {
            document.getElementById('anatomy-title').innerText = t;
            document.getElementById('anatomy-desc').innerText = d;
        }
    };
            window.onload = () => app.init();
        </script>
</body>
</html>
