<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bill Donahue | Official Archive</title>
   
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
    <style>
        :root {
            --bg: #050505;
            --card-bg: #0A0A0A;
            --border: #222;
            --purple: #D8B4FE;
            --purple-glow: rgba(216, 180, 254, 0.2);
            --gold: #D4AF37;
            --text-main: #EAEAEA;
            --orange: #FFCC80;
            --orange-glow: rgba(255, 204, 128, 0.25);
            --cyan: #22d3ee;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-main); overflow-x: hidden; height: 100vh; }
        .cinzel { font-family: 'Cinzel', serif; }
        .mono { font-family: 'Space Grotesk', monospace; }
        
        /* STARRY BACKGROUND */
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
            background: radial-gradient(circle at bottom center, #1a103c 0%, #000000 80%);
        }
        .star {
            position: absolute; border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: 0;
            box-shadow: 0 0 4px rgba(255, 215, 0, 0.3);
        }
        @keyframes twinkle { 0%, 100% { opacity: 0; } 50% { opacity: var(--opacity); } }

        /* MASONRY GRID */
        .masonry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            padding-bottom: 140px;
        }
        @media (max-width: 640px) {
            .masonry-grid { grid-template-columns: 1fr; }
        }

        /* CARDS */
        .cosmos-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px;
            z-index: 10;
        }
        .cosmos-card:hover {
            border-color: var(--orange);
            transform: translateY(-4px);
            background: #111;
            box-shadow: 0 10px 40px -10px var(--orange-glow);
        }
        .cosmos-card i { transition: transform 0.3s ease; }
        .cosmos-card:hover i { transform: scale(1.2) rotate(10deg); color: var(--orange); }

        /* DOCK */
        .dock-container {
            position: fixed; bottom: 20px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 50;
            padding: 0 20px;
        }
        .dock {
            background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.15); padding: 8px; border-radius: 20px;
            display: flex; gap: 4px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.9); pointer-events: auto;
            max-width: 100%; overflow-x: auto;
            scrollbar-width: none; 
        }
        .dock::-webkit-scrollbar { display: none; }
        
        .dock-btn {
            padding: 10px 16px; border-radius: 12px; font-size: 10px; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.1em; color: #888;
            transition: all 0.2s; cursor: pointer; border: 1px solid transparent;
            white-space: nowrap; flex-shrink: 0;
        }
        .dock-btn:hover { color: white; background: rgba(255,255,255,0.1); }
        .dock-btn.active { background: white; color: black; box-shadow: 0 0 15px rgba(255,255,255,0.2); }

        /* TOGGLE BUTTONS (Video Tab) */
        .toggle-btn {
            padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px;
            font-size: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.1em;
            color: #666; transition: all 0.3s; background: rgba(255,255,255,0.05);
        }
        .toggle-btn.active-yt { background: #DC2626; color: white; border-color: #DC2626; box-shadow: 0 0 15px rgba(220, 38, 38, 0.4); }
        .toggle-btn.active-arc { background: #22d3ee; color: black; border-color: #22d3ee; box-shadow: 0 0 15px rgba(34, 211, 238, 0.4); }

        /* SEARCH & INPUTS */
        .search-input {
            background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(10px);
            border: 1px solid var(--border); color: white;
            padding: 10px 20px 10px 40px; border-radius: 99px; font-size: 12px;
            width: 100%; max-width: 300px; transition: all 0.3s ease; outline: none;
        }
        .search-input:focus { border-color: var(--purple); box-shadow: 0 0 20px rgba(216, 180, 254, 0.2); }

        /* ANATOMY */
        .anatomy-wrapper {
            position: relative; width: 300px; height: 650px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 999px;
            background: #080808;
            box-shadow: 0 0 80px -20px rgba(168,85,247,0.15);
        }
        @media (max-width: 768px) {
            .anatomy-scale-container { transform: scale(0.75); transform-origin: top center; height: 500px; }
        }
        .anatomy-dot {
            width: 24px; height: 24px; border-radius: 50%;
            position: absolute; left: 50%; transform: translateX(-50%);
            cursor: pointer; transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.5);
            box-shadow: 0 0 15px rgba(255,255,255,0.2); z-index: 20;
        }
        .anatomy-dot:hover { transform: translateX(-50%) scale(1.5); border-color: white; }

        /* VIEWS */
        .view-section {
            display: none; padding-top: 140px; padding-bottom: 150px;
            width: 100%; min-height: 100vh; animation: fadeIn 0.4s ease;
        }
        .view-section.active { display: block; }
        #view-home.active { display: flex; flex-direction: column; justify-content: center; align-items: center; padding-top: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* UTILS */
        .hidden { display: none !important; }
        .highlight { background: rgba(216, 180, 254, 0.2); color: #fff; font-weight: bold; border-radius: 2px; padding: 0 2px; }
        .profile-img { box-shadow: 0 0 50px rgba(216, 180, 254, 0.15); transition: 0.5s; }
        .profile-img:hover { box-shadow: 0 0 80px rgba(216, 180, 254, 0.3); transform: scale(1.02); }
       
        /* MEDITATION */
        #view-meditation { background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%); }
        .audio-visualizer { display: flex; align-items: center; justify-content: center; gap: 4px; height: 30px; }
        .audio-bar { width: 4px; background: var(--purple); border-radius: 4px; animation: audioWave 1s ease-in-out infinite; }
        @keyframes audioWave { 0%, 100% { height: 5px; opacity: 0.5; } 50% { height: 25px; opacity: 1; } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--purple); }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div id="stars-container" class="stars-container"></div>

    <div class="fixed top-0 left-0 w-full p-4 z-40 flex justify-between items-center bg-black/80 backdrop-blur-xl border-b border-white/5 shadow-2xl">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="window.app.nav('home')">
            <div class="w-10 h-10 border border-purple-400/30 flex items-center justify-center rotate-45 bg-black/50 backdrop-blur-md transition-all group-hover:rotate-0 group-hover:border-purple-400 shrink-0">
                <span class="cinzel font-bold text-lg text-purple-300 -rotate-45 group-hover:rotate-0">HM</span>
            </div>
            <div>
                <h1 class="cinzel font-bold text-white text-xs md:text-sm tracking-widest uppercase leading-tight">Hidden<br>Meanings</h1>
            </div>
        </div>
        <div class="relative group w-1/2 max-w-[240px]">
            <input type="text" id="global-search" oninput="window.app.performAISearch()" onkeydown="if(event.key === 'Enter') window.app.performAISearch()" placeholder="SEARCH..." class="search-input placeholder-gray-500 font-mono uppercase">
        </div>
    </div>

    <div id="app-loader" class="fixed inset-0 bg-[#050505] z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-12 h-12 border-2 border-purple-500/30 border-t-purple-400 rounded-full animate-spin mb-4"></div>
        <p class="text-purple-300 text-xs uppercase tracking-[0.3em] font-bold animate-pulse">Initializing...</p>
    </div>

    <div id="video-modal" class="fixed inset-0 z-[60] bg-black/95 backdrop-blur-xl hidden flex items-center justify-center p-4 transition-all duration-300" onclick="if(event.target === this) window.app.closeVideo()">
        <div class="relative w-full max-w-6xl aspect-video bg-black border border-white/10 rounded-2xl overflow-hidden shadow-2xl flex flex-col">
            <button onclick="window.app.closeVideo()" class="absolute top-4 right-4 z-50 w-10 h-10 bg-black/50 text-white rounded-full hover:bg-red-600 transition-colors flex items-center justify-center border border-white/20 backdrop-blur-md">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <div id="video-frame-container" class="w-full h-full bg-black"></div>
        </div>
    </div>

    <div class="h-screen overflow-y-auto custom-scrollbar" id="scroll-wrapper">
       
        <section id="view-home" class="view-section active">
            <div class="relative z-10 max-w-5xl text-center fade-in pt-10 px-4">
                <div class="mb-8 flex justify-center">
                    <div class="relative w-32 h-32 md:w-40 md:h-40 rounded-full p-1 border-2 border-purple-500/40 bg-[#111] profile-img">
                        <img src="bill_profile.jpg" class="w-full h-full object-cover rounded-full opacity-90 transition-opacity grayscale hover:grayscale-0"
                             onerror="this.src='https://ui-avatars.com/api/?name=Bill+Donahue&background=000&color=d8b4fe&size=160'">
                    </div>
                </div>
                <div class="mb-6 inline-flex items-center gap-3 border border-purple-500/30 px-4 py-2 rounded-full bg-black/40 backdrop-blur-md">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span>
                    <span class="text-[10px] text-purple-200 uppercase tracking-[0.2em] font-bold" id="status-bar">System Online</span>
                </div>
                <h1 class="cinzel text-4xl md:text-8xl font-black mb-6 leading-none tracking-tight text-white drop-shadow-2xl">
                    HIDDEN<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-white italic">MEANINGS</span>
                </h1>
                <div class="max-w-lg mx-auto relative group w-full mb-8 px-4">
                    <input type="text" id="ai-input" placeholder="Ask the Teacher (e.g. 'Pineal')..."
                           class="w-full bg-white/5 border border-white/10 rounded-full py-4 pl-8 pr-16 text-sm text-white placeholder-stone-500 focus:outline-none focus:border-purple-400 font-mono transition-all backdrop-blur-md"
                           onkeydown="if(event.key === 'Enter') window.app.performAISearch()">
                    <button onclick="window.app.performAISearch()" class="absolute right-6 top-2 bottom-2 bg-purple-600 text-white w-10 rounded-full flex items-center justify-center hover:bg-white hover:text-black transition-colors shadow-lg">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </section>

        <section id="view-library" class="view-section px-6">
            <div class="max-w-[1800px] mx-auto w-full">
                <div class="flex flex-col md:flex-row justify-between items-end mb-16 pb-8 border-b border-white/10">
                    <div>
                        <h2 class="cinzel text-3xl md:text-5xl font-bold text-white mb-2 tracking-tight">The Catalog</h2>
                        <p class="font-mono text-purple-400 text-[10px] md:text-xs uppercase tracking-[0.2em]">Comprehensive Subject Index</p>
                    </div>
                    <div class="text-right mt-4 md:mt-0"><p class="text-stone-500 font-mono text-xs" id="total-topics-display">Loading...</p></div>
                </div>
                <div id="category-grid" class="masonry-grid"></div>
            </div>
        </section>

        <section id="view-list" class="view-section bg-stone-900/10 px-6">
            <div class="max-w-6xl mx-auto w-full">
                <button onclick="window.app.nav('library')" class="mb-10 text-stone-500 hover:text-purple-300 flex items-center gap-2 text-[10px] font-bold uppercase tracking-[0.2em] transition-colors"><span>←</span> Back to Index</button>
                <div class="mb-12 pl-6 border-l-2 border-purple-500">
                    <span class="text-purple-400 text-[10px] font-bold uppercase tracking-[0.3em] mb-3 block">Selected Topic</span>
                    <h2 id="active-category-title" class="cinzel text-3xl md:text-6xl font-bold text-white leading-tight"></h2>
                    <p id="active-category-count" class="text-stone-500 text-xs tracking-[0.2em] font-bold uppercase mt-6 pt-6 border-t border-white/5 inline-block"></p>
                </div>
                <div id="list-container" class="grid grid-cols-1 lg:grid-cols-2 gap-4"></div>
            </div>
        </section>

        <section id="view-anatomy" class="view-section px-6">
            <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-10 items-center min-h-[70vh] w-full">
                <div class="relative flex justify-center order-2 lg:order-1 anatomy-scale-container">
                    <div id="anatomy-diagram" class="anatomy-wrapper flex justify-center items-center">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(255,255,255,0.03),transparent_70%)] rounded-full"></div>
                        <div class="absolute top-[10%] bottom-[10%] w-px bg-gradient-to-b from-transparent via-white/20 to-transparent"></div>
                        <div class="anatomy-dot" style="top: 10%; background: #a855f7; box-shadow: 0 0 20px #a855f7;" onclick="window.app.showAnatomy('crown')"></div>
                        <div class="anatomy-dot" style="top: 22%; background: #4f46e5; box-shadow: 0 0 20px #4f46e5;" onclick="window.app.showAnatomy('brow')"></div>
                        <div class="anatomy-dot" style="top: 34%; background: #3b82f6; box-shadow: 0 0 20px #3b82f6;" onclick="window.app.showAnatomy('throat')"></div>
                        <div class="anatomy-dot" style="top: 46%; background: #22c55e; box-shadow: 0 0 20px #22c55e;" onclick="window.app.showAnatomy('heart')"></div>
                        <div class="anatomy-dot" style="top: 58%; background: #eab308; box-shadow: 0 0 20px #eab308;" onclick="window.app.showAnatomy('solar')"></div>
                        <div class="anatomy-dot" style="top: 70%; background: #f97316; box-shadow: 0 0 20px #f97316;" onclick="window.app.showAnatomy('sacral')"></div>
                        <div class="anatomy-dot" style="top: 82%; background: #ef4444; box-shadow: 0 0 20px #ef4444;" onclick="window.app.showAnatomy('root')"></div>
                    </div>
                </div>
                <div class="order-1 lg:order-2 text-center lg:text-left">
                    <span class="text-purple-400 font-mono text-xs uppercase tracking-[0.2em] mb-4 block">The 7 Seals of Revelation</span>
                    <h2 class="cinzel text-4xl md:text-7xl font-bold text-white mb-8 leading-none">The Temple<br>Of God</h2>
                    <div id="anatomy-info" class="p-8 border border-white/10 bg-[#111] backdrop-blur-md rounded-xl border-l-4 border-purple-500 relative z-20 transition-all duration-500">
                        <div id="anatomy-content-default">
                            <h3 class="cinzel text-xl md:text-2xl text-stone-200 mb-4 uppercase tracking-widest font-bold">Select a Center</h3>
                            <p class="text-stone-400 text-sm md:text-lg leading-relaxed font-light italic">"Know ye not that ye are the temple of God?"<br><br>Click the energy centers on the diagram to reveal the biological decoding.</p>
                        </div>
                        <div id="anatomy-content-active" class="hidden text-left">
                            <div class="flex justify-between items-start mb-2"><span id="ana-name" class="text-xs font-bold uppercase tracking-[0.2em] text-white/50"></span><span id="ana-freq" class="text-xs font-mono text-white/30"></span></div>
                            <h3 id="ana-title" class="cinzel text-3xl text-white mb-6 font-bold leading-none"></h3>
                            <div class="grid grid-cols-2 gap-4 mb-6 border-t border-white/10 pt-4">
                                <div><span class="block text-[9px] uppercase text-stone-500 tracking-widest mb-1">Biblical Symbol</span><span id="ana-bib" class="text-sm text-white font-serif italic"></span></div>
                                <div><span class="block text-[9px] uppercase text-stone-500 tracking-widest mb-1">Church</span><span id="ana-church" class="text-sm text-white font-serif italic"></span></div>
                            </div>
                            <p id="ana-desc" class="text-stone-300 text-sm leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-search" class="view-section px-6 max-w-5xl mx-auto bg-[#050505]">
            <div id="ai-box" class="mb-12 bg-white/5 p-8 border-l-4 border-purple-500 hidden rounded-xl fade-in relative">
                <div class="flex justify-between items-start mb-4">
                    <span class="text-purple-400 font-mono text-[10px] uppercase tracking-widest block">Teacher's Insight</span>
                    <button id="ai-video-link" onclick="" class="hidden text-[10px] bg-purple-600 text-white px-3 py-1 rounded-full hover:bg-white hover:text-black transition-colors font-bold uppercase tracking-widest"><i class="fa-solid fa-play mr-1"></i> Watch Video</button>
                </div>
                <div id="ai-text-output" class="text-stone-200 text-lg md:text-xl leading-relaxed italic font-light mb-6 font-serif"></div>
                
                <div class="flex flex-wrap items-center gap-4 border-t border-white/5 pt-4">
                    <button id="play-pause-btn" onclick="window.app.togglePlayPause()" class="flex items-center gap-2 text-xs font-bold text-purple-300 uppercase tracking-widest hover:text-white"><i class="fa-solid fa-play"></i> Play</button>
                    <button id="stop-btn" onclick="window.app.stopAudio()" class="flex items-center gap-2 text-xs font-bold text-purple-300 uppercase tracking-widest hover:text-white hidden"><i class="fa-solid fa-stop"></i> Stop</button>
                    
                    <div class="flex items-center gap-2 ml-auto">
                        <span class="text-[9px] text-stone-500 uppercase font-bold tracking-widest">Voice:</span>
                        <select id="voice-select" onchange="window.app.testVoice()" class="bg-black border border-white/20 text-white text-[10px] py-1 px-2 rounded uppercase font-mono max-w-[150px]">
                            <option value="">Default</option>
                        </select>
                        <button onclick="window.app.testVoice()" class="text-[9px] bg-white/10 hover:bg-white/20 text-white px-2 py-1 rounded">TEST</button>
                    </div>
                </div>
            </div>
           
            <div class="flex justify-between items-end mb-8 border-b border-white/10 pb-4">
                <h2 id="search-title" class="cinzel text-2xl font-bold text-white">Archive Matches</h2>
                <div id="download-area"></div>
            </div>
            <div id="search-list" class="masonry-grid pb-20"></div>
        </section>

        <section id="view-videos" class="view-section px-6">
              <div class="max-w-[1800px] mx-auto w-full">
                <div class="mb-10 pb-8 border-b border-white/10 flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
                    <div>
                        <h2 class="cinzel text-3xl md:text-5xl font-bold text-white mb-2">The Archive</h2>
                        <p class="font-mono text-purple-400 text-xs uppercase tracking-[0.2em]">Video Collection</p>
                    </div>
                    
                    <div class="flex gap-2">
                        <button id="toggle-yt" class="toggle-btn active-yt" onclick="window.app.setVideoSource('youtube')">
                            <i class="fa-brands fa-youtube mr-2"></i> YouTube
                        </button>
                        <button id="toggle-arc" class="toggle-btn" onclick="window.app.setVideoSource('archive')">
                            <i class="fa-solid fa-film mr-2"></i> HD Restored
                        </button>
                    </div>
                </div>
                
                <div id="video-grid" class="masonry-grid"></div>
                
                <div id="video-loader" class="text-center py-8 hidden">
                    <i class="fa-solid fa-circle-notch fa-spin text-purple-500 text-2xl"></i>
                    <p class="mt-2 text-[10px] text-stone-500 font-mono uppercase">Loading Data...</p>
                </div>
              </div>
        </section>
        
        <section id="view-meditation" class="view-section px-6">
            <div class="max-w-4xl mx-auto text-center pt-10">
                 <h1 class="cinzel text-4xl md:text-6xl font-bold text-white mb-6">The Upper Room</h1>
                 <p class="text-stone-400 text-lg md:text-xl italic font-serif mb-16 max-w-2xl mx-auto leading-relaxed">"When you pray, enter into your closet, and when you have shut the door, pray to your Father which is in secret."</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-20">
                    <div class="cosmos-card p-8 bg-black/50 backdrop-blur-md border-purple-500/20">
                        <div class="h-48 mb-6 rounded-full overflow-hidden border-2 border-purple-500/30 relative flex items-center justify-center">
                             <div class="absolute inset-0 bg-[url('https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbnZ4anh5eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7TKSjRrfIPjeiGGQ/giphy.gif')] bg-cover bg-center opacity-60 grayscale hover:grayscale-0 transition-all duration-1000"></div>
                             <i class="fa-solid fa-eye text-5xl text-white drop-shadow-[0_0_15px_rgba(216,180,254,0.8)] relative z-10"></i>
                        </div>
                        <h3 class="cinzel text-2xl text-white mb-3">The Single Eye</h3>
                        <p class="text-stone-400 text-sm leading-relaxed mb-6">Focus your attention on the space between your eyebrows.</p>
                    </div>
                    <div class="cosmos-card p-8 bg-black/50 backdrop-blur-md border-blue-500/20">
                         <div class="h-48 mb-6 rounded-full overflow-hidden border-2 border-blue-500/30 relative flex items-center justify-center bg-black">
                             <div class="audio-visualizer" id="audio-viz">
                                 <div class="audio-bar" style="animation-delay: 0s;"></div>
                                 <div class="audio-bar" style="animation-delay: 0.2s;"></div>
                                 <div class="audio-bar" style="animation-delay: 0.4s;"></div>
                                 <div class="audio-bar" style="animation-delay: 0.6s;"></div>
                                 <div class="audio-bar" style="animation-delay: 0.8s;"></div>
                             </div>
                        </div>
                        <h3 class="cinzel text-2xl text-white mb-3">The Inner Silence</h3>
                        <p class="text-stone-400 text-sm leading-relaxed mb-6">Shut down the five senses of Egypt.</p>
                        <audio id="meditation-audio" loop preload="none">
                            <source src="https://cdn.freesound.org/previews/666/666730_11239424-lq.mp3" type="audio/mpeg">
                        </audio>
                        <button id="meditation-play-btn" onclick="window.app.toggleMeditationAudio()" class="w-full py-3 rounded-full bg-blue-900/30 text-blue-300 hover:bg-blue-500 hover:text-white font-bold uppercase tracking-widest text-xs transition-all border border-blue-500/30 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-play"></i> Begin Transmission
                        </button>
                    </div>
                 </div>
            </div>
        </section>

        <section id="view-resources" class="view-section px-6 max-w-5xl mx-auto">
            <h2 class="cinzel text-3xl md:text-4xl font-bold text-white mb-16 text-center uppercase tracking-widest">Primary Sources</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <a href="https://www.facebook.com/groups/356472414984195" target="_blank" class="cosmos-card p-8 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#1877F2]/20 flex items-center justify-center text-[#1877F2]"><i class="fa-brands fa-facebook-f"></i></div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Facebook Community</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">Official Discussion Group</p>
                </a>

                <a href="https://www.hiddenmeanings.com/" target="_blank" class="cosmos-card p-8 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">H</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">HiddenMeanings.com</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">Main Portal</p>
                </a>
                <a href="https://lifestyleluminaries.blogspot.com/p/bill-donahue.html" target="_blank" class="cosmos-card p-8 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">L</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Lifestyle Luminaries</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">Video Archive</p>
                </a>
                <a href="https://thehiddenlighthouse.blogspot.com/2012/09/the-hidden-lighthouse.html?m=1" target="_blank" class="cosmos-card p-8 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">B</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Lighthouse Blog</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">2012 Writings</p>
                </a>
                <a href="https://archive.org/details/1-revised-bill-donahue-speaks-book-of-secret-doctrines/page/18/mode/1up?ui=embed&wrapper=false" target="_blank" class="cosmos-card p-8 group bg-[#0A0A0A] hover:bg-[#111] block">
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-10 h-10 rounded-full bg-[#222] flex items-center justify-center text-white font-serif">S</div>
                        <span class="text-gray-600 group-hover:text-white transition-colors">↗</span>
                    </div>
                    <h3 class="cinzel text-2xl text-white mb-2 group-hover:text-purple-300 transition-colors">Secret Doctrines</h3>
                    <p class="font-mono text-stone-500 text-xs uppercase tracking-widest">PDF Book</p>
                </a>
            </div>
        </section>

    </div>

    <div class="dock-container">
        <div class="dock">
            <button class="dock-btn active" id="btn-home" onclick="window.app.nav('home')">Home</button>
            <button class="dock-btn" id="btn-library" onclick="window.app.nav('library')">Library</button>
            <button class="dock-btn" id="btn-videos" onclick="window.app.nav('videos')">Videos</button>
            <button class="dock-btn" id="btn-anatomy" onclick="window.app.nav('anatomy')">Temple</button>
            <button class="dock-btn" id="btn-meditation" onclick="window.app.nav('meditation')">Meditation</button> 
            <button class="dock-btn" id="btn-resources" onclick="window.app.nav('resources')">Links</button>
            <div class="w-px bg-white/20 mx-1"></div>
            <button class="dock-btn text-red-400 hover:text-red-300" onclick="window.app.scanForBrokenLinks()" title="Scan for Bad Links"><i class="fa-solid fa-stethoscope"></i></button>
        </div>
    </div>

    <script>
        function createStars() {
            const container = document.getElementById('stars-container');
            if(!container) return;
            for(let i=0; i<150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                const size = Math.random() * 2 + 0.5;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.backgroundColor = `hsl(${Math.random() * 40}, ${Math.random() * 20 + 70}%, ${Math.random() * 20 + 70}%)`;
                star.style.boxShadow = `0 0 ${size*2}px ${star.style.backgroundColor}`;
                star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                star.style.setProperty('--opacity', Math.random() * 0.5 + 0.5);
                container.appendChild(star);
            }
        }
        
        window.app = {
            data: [], 
            transcriptData: null, 
            currentUtterance: null, 
            isSpeaking: false,
            
            // STATE for Merged Video Tab
            currentVideoSource: 'youtube', // 'youtube' or 'archive'
            archiveVideos: [],
            archivePage: 1,
            archiveLoading: false,
            archiveHasMore: true,
            
            // --- ANATOMY DATA ---
            anatomyData: {
                "root": { title: "Root / Base", name: "Muladhara", color: "#ef4444", freq: "400-484 THz", biblical: "Egypt / The Red Sea", church: "Ephesus", desc: "The starting point. Egypt represents the physical bondage of the senses." },
                "sacral": { title: "Sacral", name: "Svadhisthana", color: "#f97316", freq: "484-508 THz", biblical: "Wilderness", church: "Smyrna", desc: "The seat of emotions and sexual energy." },
                "solar": { title: "Solar Plexus", name: "Manipura", color: "#eab308", freq: "508-526 THz", biblical: "The Manger", church: "Pergamos", desc: "The place of the Sun (Son)." },
                "heart": { title: "Heart", name: "Anahata", color: "#22c55e", freq: "526-606 THz", biblical: "Jerusalem", church: "Thyatira", desc: "The balance point. The Green Ray." },
                "throat": { title: "Throat", name: "Vishuddha", color: "#3b82f6", freq: "606-668 THz", biblical: "Jordan River", church: "Sardis", desc: "The power of the Word (Logos)." },
                "brow": { title: "Brow / Third Eye", name: "Ajna", color: "#4f46e5", freq: "668-789 THz", biblical: "The Single Eye", church: "Philadelphia", desc: "The Command Center." },
                "crown": { title: "Crown / Pineal", name: "Sahasrara", color: "#a855f7", freq: "789+ THz", biblical: "The Promised Land / Peniel", church: "Laodicea", desc: "The destination. The Pineal Gland. Peniel - 'I have seen God face to face.'" }
            },
           
            // --- UTILS ---
            getVideoID: function(url) {
                if (!url) return null;
                const str = url.toString().trim();
                if (/^[a-zA-Z0-9_-]{11}$/.test(str)) return str;
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = str.match(regExp);
                return (match && match[2].length === 11) ? match[2] : null;
            },

            createTagButton: function(topic) {
                if(!topic || topic === "General") return `<span class="text-[9px] text-stone-600 font-mono uppercase tracking-widest block py-1.5 opacity-30">Uncatalogued</span>`;
                const safeTopic = topic.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                return `<button class="inline-flex items-center gap-2 text-[9px] font-bold uppercase tracking-widest text-purple-300 bg-purple-900/20 border border-purple-500/30 px-3 py-1.5 rounded hover:bg-purple-500 hover:text-white transition-all justify-center cursor-pointer relative z-20" onclick="event.stopPropagation(); window.app.openTopic('${safeTopic}')"><i class="fa-solid fa-tag"></i> ${topic}</button>`;
            },

            getTopicByVideoID: function(vidId, vidTitle) {
                if (!this.data || this.data.length === 0) return null;
                const matchById = this.data.find(row => { const csvId = this.getVideoID(row.URL); return csvId === vidId; });
                if (matchById) return matchById.TOPIC;
                if (vidTitle) {
                    const cleanVidTitle = vidTitle.toLowerCase().replace(/[^a-z0-9]/g, '');
                    const matchByTitle = this.data.find(row => { const cleanRowTitle = row['TITLE OF VIDEO'].toLowerCase().replace(/[^a-z0-9]/g, ''); return cleanRowTitle.includes(cleanVidTitle) || cleanVidTitle.includes(cleanRowTitle); });
                    if (matchByTitle) return matchByTitle.TOPIC;
                }
                return null;
            },

            // --- NAV & UI ---
            nav: function(id) { 
                document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active')); 
                document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active')); 
                const target = document.getElementById('view-' + id); 
                if(target) target.classList.add('active'); 
                const btn = document.getElementById('btn-' + id); 
                if(btn) btn.classList.add('active'); 
                if(id !== 'search') document.getElementById('global-search').value = ''; 
                if(id !== 'meditation') { const audio = document.getElementById('meditation-audio'); if(audio && !audio.paused) { audio.pause(); document.getElementById('meditation-play-btn').innerHTML = '<i class="fa-solid fa-play"></i> Begin Transmission'; document.getElementById('audio-viz').style.opacity = '0.3'; }}
                window.scrollTo(0,0); 
            },
            showAnatomy: function(key) { const data = this.anatomyData[key]; if(!data) return; document.getElementById('anatomy-content-default').classList.add('hidden'); const content = document.getElementById('anatomy-content-active'); content.classList.remove('hidden'); document.getElementById('ana-name').innerText = data.name; document.getElementById('ana-freq').innerText = data.freq; document.getElementById('ana-title').innerText = data.title; document.getElementById('ana-bib').innerText = data.biblical; document.getElementById('ana-church').innerText = data.church; document.getElementById('ana-desc').innerText = data.desc; const box = document.getElementById('anatomy-info'); box.style.borderColor = data.color; box.style.boxShadow = `0 0 30px -10px ${data.color}`; document.getElementById('ana-title').style.color = data.color; },

            // --- VIDEO PLAYER ---
            openVideo: function(id, type) {
                if(!id || id === 'null') return;
                // Auto-detect type if not provided, based on current mode
                if (!type) type = (this.currentVideoSource === 'archive' && !id.match(/^[a-zA-Z0-9_-]{11}$/)) ? 'archive' : 'youtube';
                
                const modal = document.getElementById('video-modal');
                const container = document.getElementById('video-frame-container');
                let src = type === 'archive' ? `https://archive.org/embed/${id}?autoplay=1` : `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;
                container.innerHTML = `<iframe src="${src}" class="w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                modal.classList.remove('hidden');
            },
            closeVideo: function() { document.getElementById('video-frame-container').innerHTML = ''; document.getElementById('video-modal').classList.add('hidden'); },

            // --- MERGED VIDEO LOGIC ---
            setVideoSource: function(source) {
                this.currentVideoSource = source;
                
                // Toggle Buttons
                const btnYT = document.getElementById('toggle-yt');
                const btnArc = document.getElementById('toggle-arc');
                if (source === 'youtube') {
                    btnYT.classList.add('active-yt');
                    btnArc.classList.remove('active-arc');
                } else {
                    btnYT.classList.remove('active-yt');
                    btnArc.classList.add('active-arc');
                }

                // Initial Load if Empty
                if (source === 'archive' && this.archiveVideos.length === 0) {
                    this.fetchArchiveVideos();
                }

                this.renderMergedGrid();
            },

            fetchArchiveVideos: async function() {
                if (this.archiveLoading || !this.archiveHasMore) return;
                this.archiveLoading = true;
                document.getElementById('video-loader').classList.remove('hidden');

                // Filter by user "jesse_floyd405"
                const query = 'uploader:jesse_floyd405 AND mediatype:movies';
                const rows = 50;
                const url = `https://archive.org/advancedsearch.php?q=${encodeURIComponent(query)}&fl[]=identifier&fl[]=title&fl[]=description&fl[]=external-identifier&fl[]=downloads&sort[]=-addeddate&output=json&rows=${rows}&page=${this.archivePage}`;

                try {
                    const res = await fetch(url);
                    const data = await res.json();
                    
                    if (data.response && data.response.docs && data.response.docs.length > 0) {
                        this.archiveVideos.push(...data.response.docs);
                        this.archivePage++;
                    } else {
                        this.archiveHasMore = false; // Stop fetching if no more results
                    }
                    
                    if (this.currentVideoSource === 'archive') {
                        this.renderMergedGrid();
                    }
                } catch (e) {
                    console.error("Archive Error", e);
                }
                
                this.archiveLoading = false;
                document.getElementById('video-loader').classList.add('hidden');
            },

            renderMergedGrid: function() {
                const grid = document.getElementById("video-grid");
                grid.innerHTML = '';
                
                let videosToRender = [];
                let isArchive = (this.currentVideoSource === 'archive');

                if (isArchive) {
                    videosToRender = this.archiveVideos;
                    if (videosToRender.length === 0 && !this.archiveLoading) {
                        grid.innerHTML = '<div class="col-span-full text-center py-20 text-stone-500">No Restored Videos Found Yet.<br><span class="text-xs">Uploads take ~30mins to appear.</span></div>';
                        return;
                    }
                } else {
                    videosToRender = this.youtube.videos;
                }

                grid.innerHTML = videosToRender.map(v => {
                    // Extract Data based on Source
                    let id, title, thumb, displayID, topic, linkUrl;
                    let crossRefBtn = '';

                    if (isArchive) {
                        id = v.identifier;
                        title = v.title;
                        thumb = `https://archive.org/services/img/${id}`;
                        displayID = id;
                        linkUrl = `https://archive.org/details/${id}`;
                        topic = this.getTopicByVideoID(null, title); // Try to match by title
                        
                        // Check for Youtube ID to create "Source" Link
                        if (v['external-identifier'] && v['external-identifier'].includes('urn:youtube:')) {
                            const ytId = v['external-identifier'].replace('urn:youtube:', '');
                            crossRefBtn = `<button onclick="event.stopPropagation(); window.open('https://youtube.com/watch?v=${ytId}', '_blank')" class="text-[9px] text-red-400 border border-red-900/50 px-2 py-1 rounded hover:bg-red-900 hover:text-white transition-colors uppercase font-bold tracking-widest"><i class="fa-brands fa-youtube mr-1"></i> Source</button>`;
                        }
                    } else {
                        id = v.id;
                        title = v.title;
                        thumb = v.thumbnail;
                        displayID = id;
                        linkUrl = `https://www.youtube.com/watch?v=${id}`;
                        topic = window.app.getTopicByVideoID(id, title);
                    }
                    
                    return `
                    <div class="cosmos-card group">
                        <div class="relative aspect-video overflow-hidden cursor-pointer bg-black" onclick="window.app.openVideo('${id}', '${isArchive ? 'archive' : 'youtube'}')">
                            <img src="${thumb}" class="absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" onerror="this.src='https://archive.org/images/not_found.png'" />
                            <div class="absolute inset-0 flex items-center justify-center">
                                <i class="fa-solid ${isArchive ? 'fa-film text-cyan-400' : 'fa-play text-white'} text-4xl opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg"></i>
                            </div>
                            ${isArchive ? '<div class="absolute top-2 right-2 bg-black/80 text-cyan-400 text-[9px] px-2 py-1 rounded font-mono uppercase tracking-widest border border-cyan-900/50">Restored</div>' : ''}
                        </div>
                        <div class="p-4 flex flex-col flex-1 bg-[#0A0A0A] border-t border-white/5">
                            <h3 class="text-sm text-gray-200 group-hover:text-white line-clamp-2 mb-3 font-medium">${title}</h3>
                            
                            <div class="mt-auto pt-2 border-t border-white/5 flex flex-wrap gap-2 justify-between items-center">
                                ${this.createTagButton(topic)}
                                ${crossRefBtn}
                            </div>
                            
                            <div class="mt-3 pt-2 border-t border-white/5 text-right">
                                <a href="${linkUrl}" target="_blank" onclick="event.stopPropagation();" class="text-[9px] text-stone-600 font-mono hover:text-purple-400 transition-colors">
                                    ID: ${displayID} <i class="fa-solid fa-arrow-up-right-from-square ml-1 text-[8px]"></i>
                                </a>
                            </div>
                        </div>
                    </div>`;
                }).join("");
            },

            // --- YOUTUBE LOGIC ---
            youtube: {
                apiKey: "AIzaSyCZfKNXHgjZG1h13QhDH5-ubtVC0xDPfe4", uploadsPlaylistId: "UUinvwSeMdmuuzyMWrS0tGTg", videos: [], nextPageToken: null, loading: false,
                fetchVideos: async function () {
                    if (this.loading) return; this.loading = true;
                    document.getElementById('video-loader').classList.remove('hidden');
                    let url = `https://www.googleapis.com/youtube/v3/playlistItems?key=${this.apiKey}&playlistId=${this.uploadsPlaylistId}&part=snippet&maxResults=24`;
                    if (this.nextPageToken) url += `&pageToken=${this.nextPageToken}`;
                    try {
                        const res = await fetch(url); const data = await res.json();
                        this.nextPageToken = data.nextPageToken || null;
                        this.videos.push(...data.items.map(item => ({ id: item.snippet.resourceId.videoId, title: item.snippet.title, thumbnail: item.snippet.thumbnails.high.url })));
                        if (window.app.currentVideoSource === 'youtube') window.app.renderMergedGrid();
                    } catch (e) { console.error("YT Error", e); }
                    this.loading = false;
                    document.getElementById('video-loader').classList.add('hidden');
                }
            },

            // --- CATEGORIES ---
            getUniqueTopics: function() { return [...new Set(this.data.map(i => i.TOPIC).filter(t => t))].sort((a, b) => a.localeCompare(b)); },
            renderCategories: function() { 
                const topics = this.getUniqueTopics(); 
                document.getElementById('total-topics-display').innerText = `${topics.length} Categories`; 
                document.getElementById('category-grid').innerHTML = topics.map((t, i) => { 
                    const count = this.data.filter(d => d.TOPIC === t).length; 
                    const safeTopic = t.replace(/'/g, "\\'").replace(/"/g, '&quot;'); 
                    return `<div onclick="window.app.openTopic('${safeTopic}')" class="cosmos-card topic-card p-6 group"><div class="flex justify-between items-start mb-4"><span class="text-xs font-mono text-gray-500">${String(i+1).padStart(2, '0')}</span><i class="fa-solid fa-star text-gray-600 group-hover:text-purple-400 transition-colors text-lg"></i></div><h3 class="text-sm font-medium text-gray-200 leading-snug mb-8 group-hover:text-white line-clamp-3">${t}</h3><div class="flex justify-between items-end border-t border-white/10 pt-3 mt-auto"><span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">${count} Items</span><span class="text-purple-400 opacity-50 group-hover:opacity-100 transition-opacity">→</span></div></div>`; 
                }).join(''); 
            },
            openTopic: function(topic) { 
                this.nav('list'); document.getElementById('active-category-title').innerText = topic; 
                const items = this.data.filter(i => i.TOPIC === topic); 
                document.getElementById('active-category-count').innerText = `${items.length} LECTURES`; 
                document.getElementById('list-container').innerHTML = items.map(l => { 
                    const vidId = this.getVideoID(l.URL); const thumbUrl = vidId ? `https://img.youtube.com/vi/${vidId}/mqdefault.jpg` : null; 
                    return `<div class="p-3 border border-white/10 rounded-lg flex gap-4 items-center hover:bg-white/5 transition-all group mb-2 bg-[#0A0A0A]"><div class="w-24 h-16 bg-black shrink-0 rounded overflow-hidden relative border border-white/10 cursor-pointer" onclick="window.app.openVideo('${vidId}')">${thumbUrl ? `<img src="${thumbUrl}" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity">` : ''}<div class="absolute inset-0 flex items-center justify-center pointer-events-none"><i class="fa-solid fa-play text-2xl text-white opacity-0 group-hover:opacity-100 transition-opacity"></i></div></div><div class="flex-1 min-w-0"><h4 class="text-sm font-medium text-gray-300 group-hover:text-white truncate pr-4 cursor-pointer" onclick="window.app.openVideo('${vidId}')">${l['TITLE OF VIDEO']}</h4><p class="text-[10px] text-gray-600 font-mono mt-1">ID: ${vidId}</p></div><div class="shrink-0"><button onclick="window.app.openVideo('${vidId}')" class="w-8 h-8 rounded-full border border-purple-500/30 flex items-center justify-center text-purple-400 hover:bg-purple-500 hover:text-white transition-all"><i class="fa-solid fa-play text-xs pl-0.5"></i></button></div></div>`; 
                }).join(''); 
            },

            // --- AI SEARCH ---
            populateVoices: function() {
                const select = document.getElementById('voice-select'); if(!select) return;
                const voices = speechSynthesis.getVoices();
                select.innerHTML = voices.map((v, i) => `<option value="${i}">${v.name} (${v.lang})</option>`).join('');
                const best = voices.findIndex(v => v.name.includes("David") || v.name.includes("Male")); if(best !== -1) select.value = best;
            },
            testVoice: function() { const select = document.getElementById('voice-select'); const voiceIndex = select.value; const voices = speechSynthesis.getVoices(); if(voiceIndex && voices[voiceIndex]) { const u = new SpeechSynthesisUtterance("The hidden meaning is within you."); u.voice = voices[voiceIndex]; speechSynthesis.cancel(); speechSynthesis.speak(u); }},
            performAISearch: async function() {
                const input = document.getElementById('ai-input'); let q = (input ? input.value : '').trim();
                if (!q) { const global = document.getElementById('global-search'); q = global ? global.value.trim() : ''; }
                if (!q) return; if (input) input.value = '';
                this.nav('search'); document.getElementById('ai-box').classList.remove('hidden');
                document.getElementById('ai-text-output').innerText = "Consulting the archives...";
                
                let combinedResults = [];
                this.data.forEach(row => {
                    if ((row['TITLE OF VIDEO']||"").toLowerCase().includes(q.toLowerCase()) || (row.TOPIC||"").toLowerCase().includes(q.toLowerCase())) {
                        combinedResults.push({ id: this.getVideoID(row.URL), title: row['TITLE OF VIDEO'], topic: row.TOPIC, snippet: null, score: 9999, url: row.URL });
                    }
                });
                // (Abbreviated transcript simulation)
                document.getElementById('ai-text-output').innerText = `Searching titles for "${q}"... Found ${combinedResults.length} matches.`;
                this.renderSearchResults(combinedResults, q);
            },
            renderSearchResults: function(results, query) {
                const list = document.getElementById('search-list');
                document.getElementById('search-title').innerText = `${results.length} Matches Found`;
                if(results.length === 0) { list.innerHTML = '<div class="p-8 text-center text-stone-500">No matches found.</div>'; return; }
                list.innerHTML = results.map(r => {
                    const vidId = r.id || this.getVideoID(r.url); const thumbUrl = vidId ? `https://img.youtube.com/vi/${vidId}/mqdefault.jpg` : null;
                    return `<div class="cosmos-card p-0 overflow-hidden bg-[#0A0A0A] border border-white/10 rounded-xl group hover:border-purple-500/50 transition-all cursor-pointer" onclick="window.app.openVideo('${vidId}')">
                        <div class="flex flex-col h-full"><div class="relative h-40 bg-black overflow-hidden">${thumbUrl ? `<img src="${thumbUrl}" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity">` : ''}<div class="absolute inset-0 flex items-center justify-center"><i class="fa-solid fa-play text-3xl text-white opacity-0 group-hover:opacity-100 transition-opacity"></i></div></div>
                        <div class="p-4 flex-1 flex flex-col"><h4 class="text-sm font-bold text-white mb-2 line-clamp-1">${r.title}</h4><div class="mt-auto pt-4 border-t border-white/5 flex justify-between items-center">${this.createTagButton(r.topic)}</div></div></div></div>`;
                }).join('');
            },

            // --- INIT ---
            init: function() {
                setTimeout(() => document.getElementById('app-loader').classList.add('hidden'), 1000);
                createStars();
                this.youtube.fetchVideos(); // Load YouTube first
                window.speechSynthesis.onvoiceschanged = this.populateVoices; this.populateVoices();
                
                Papa.parse('catalog.csv', { download: true, header: true, skipEmptyLines: true, complete: (results) => {
                    this.data = results.data.filter(row => row['TITLE OF VIDEO']).map(row => { row.TOPIC = (row.TOPIC || "").replace(/^and\s+/i, '').trim(); return row; });
                    this.renderCategories(); this.youtube.renderVideos();
                }});
                
                // FIXED SCROLL LISTENER (Handles both tabs)
                const wrapper = document.getElementById('scroll-wrapper');
                wrapper.addEventListener("scroll", () => {
                    if (wrapper.scrollTop + wrapper.clientHeight >= wrapper.scrollHeight - 100) {
                        if (window.app.currentVideoSource === 'youtube') {
                            window.app.youtube.fetchVideos();
                        } else {
                            window.app.fetchArchiveVideos();
                        }
                    }
                });
                
                this.nav('home');
            }
        };
        window.onload = () => app.init();
    </script>
</body>
</html>
